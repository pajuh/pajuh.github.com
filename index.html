<html>
<head>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.js"></script>  
<script>
 google.load("gdata", "1");
 google.setOnLoadCallback(getMyFeed);
 
 var myService;
 var feedUrl = "https://www.google.com/calendar/feeds/of9j56r6a0e0aip079chsrg1ns%40group.calendar.google.com/public/full";

 function setupMyService() {
   myService = new google.gdata.calendar.CalendarService('DojoAttender')
 }

 function getMyFeed() {
   setupMyService();

   myService.getEventsFeed(feedUrl, createEventList, handleError);
 }
 
 function addParticipant(entryId) {
	 var query = new google.gdata.calendar.CalendarEventQuery("https://www.google.com/calendar/feeds/of9j56r6a0e0aip079chsrg1ns%40group.calendar.google.com/private/full")
	 query.setFullTextQuery(entryId);
		 
	 myService.getEventsFeed(query, function(resultFeed) {
			$.each(resultFeed.feed.entry, function(index, eventEntry) {
				if (eventEntry.getTitle().getText() == entryId) {
					alert("updating event " + eventEntry.getTitle().getText())
					eventEntry.setTitle(google.gdata.Text.create("Dididam"))
//					eventEntry.addParticipant('email : foobar@foobar.com')
					eventEntry.updateEntry(function(result) {
						alert("updating event " + entryId + $("#addParticipant" + entryId).val())
        			}, handleError)
				}
			})
	 }, handleError);
 }
 
 function createEventList(myResultsFeedRoot) {
	 	var text = ''
		$.each(myResultsFeedRoot.feed.entry, function(index, eventEntry) {
			var entryId = eventEntry.getTitle().getText()
	 		text += "<div class='event'>"
			text += eventEntry.getTitle().getText() + "<br>Participants:<br>"
			$.each(eventEntry.getParticipants(), function(index, participant) {
				text += participant.getValueString() + "," + participant.getEmail() + "<br>"
			})
			text += "<input type='text' id='addParticipant" + entryId + "'/><input type='button' onClick='addParticipant(\"" + entryId +"\");' value='Join Dojo' />"
			text += "</div>"
		})
		$("#events").append(text)
	}

	function handleError(e) {
	  alert("There was an error!");
	  alert(e.cause ? e.cause.statusText : e.message);
	}
 
</script>
</head>
<body>
</body>
<h1>Upcoming dojos</h1>
<div id="events"></div>
<input type="button" onClick="google.accounts.user.login('https://www.google.com/calendar/feeds/')" value="Login to Google" />
</html>
